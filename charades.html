<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charades Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation; /* Prevents double-tap zoom on mobile */
        }
        .main-content {
            height: 100vh;
            height: -webkit-fill-available; /* For iOS Safari */
        }
        .category-grid {
            max-height: 60vh;
        }
        /* Custom scrollbar for better aesthetics */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        /* Countdown Animation */
        @keyframes pulse-fade {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
                opacity: 1;
            }
            80% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 0;
            }
        }
        .countdown-animate {
            animation: pulse-fade 1s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center main-content overflow-hidden">

    <!-- Screen 1: Main Menu -->
    <div id="main-menu" class="w-full h-full max-w-2xl mx-auto p-4 md:p-8 flex flex-col justify-center items-center text-center">
        <div class="absolute top-4 left-4 flex space-x-4">
             <a href="index.html" class="p-2 bg-gray-800 rounded-full hover:bg-gray-700 transition-colors" aria-label="Back to Home">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </a>
            <button id="fullscreen-btn" class="p-2 bg-gray-800 rounded-full hover:bg-gray-700 transition-colors" aria-label="Toggle Fullscreen">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1v4m0 0h-4m4-4l-5 5M4 16v4m0 0h4m-4 0l5-5m11 1v-4m0 0h-4m4 4l-5-5" /></svg>
            </button>
        </div>
        <div class="absolute top-4 right-4">
             <button id="settings-btn" class="p-2 bg-gray-800 rounded-full hover:bg-gray-700 transition-colors" aria-label="Settings">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
            </button>
        </div>

        <h1 class="text-4xl md:text-5xl font-black mb-2 uppercase tracking-wider">Charades</h1>
        <p class="text-lg text-gray-400 mb-6">Choose a category to start!</p>
        
        <div id="random-button-container" class="w-full mb-4 px-4"></div>
        <div id="category-buttons" class="grid grid-cols-2 md:grid-cols-3 gap-3 w-full overflow-y-auto custom-scrollbar px-4 category-grid"></div>
    </div>

    <!-- Screen 2: Game Screen -->
    <div id="game-screen" class="hidden w-full h-full flex flex-col relative transition-transform duration-300 ease-in-out">
        <div class="flex justify-between items-center p-4 text-xl md:text-2xl font-bold z-10 relative">
            <div id="timer" class="flex-1 text-left bg-gray-800 px-4 py-2 rounded-lg">Time: <span id="time-left">60</span></div>
             <div class="flex-1 text-center">
                <button id="stop-game-btn" class="bg-red-600 hover:bg-red-700 w-12 h-12 rounded-full flex items-center justify-center transition-transform hover:scale-110 shadow-lg" aria-label="Stop Game">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="7" y="7" width="10" height="10" rx="1"></rect>
                    </svg>
                </button>
            </div>
            <div id="score" class="flex-1 text-right bg-gray-800 px-4 py-2 rounded-lg">Score: <span id="current-score">0</span></div>
        </div>
        <div class="flex-grow flex relative -mt-16 pt-16">
            <div id="correct-area" class="w-1/2 h-full bg-green-600/80 active:bg-green-700 transition-colors cursor-pointer"></div>
            <div id="pass-area" class="w-1/2 h-full bg-red-600/80 active:bg-red-700 transition-colors cursor-pointer"></div>
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                <h2 id="word-display" class="text-5xl md:text-8xl font-extrabold text-center px-4 bg-gray-900/60 rounded-xl p-4 shadow-2xl"></h2>
            </div>
        </div>
        <div id="correct-feedback" class="absolute inset-0 bg-green-600 flex items-center justify-center text-5xl md:text-7xl font-black uppercase transition-transform duration-300 ease-in-out -translate-x-full">Correct!</div>
        <div id="pass-feedback" class="absolute inset-0 bg-red-600 flex items-center justify-center text-5xl md:text-7xl font-black uppercase transition-transform duration-300 ease-in-out translate-x-full">Passed!</div>
    </div>

    <!-- Screen 3: Final Score Screen -->
    <div id="score-screen" class="hidden w-full h-full p-4 md:p-8 flex flex-col justify-center items-center text-center">
        <div class="w-full max-w-2xl text-center">
            <h2 id="end-game-title" class="text-4xl md:text-5xl font-black mb-2">Round Over!</h2>
            <p class="text-2xl md:text-3xl text-yellow-400 mb-6">Final Score: <span id="final-score">0</span></p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-left overflow-y-auto" style="max-height: 50vh;">
                <div>
                    <h3 class="text-2xl font-bold text-green-400 border-b-2 border-green-400 pb-2 mb-3">Correct Words</h3>
                    <ul id="correct-words-list" class="space-y-1 text-lg"></ul>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-red-400 border-b-2 border-red-400 pb-2 mb-3">Passed Words</h3>
                    <ul id="passed-words-list" class="space-y-1 text-lg"></ul>
                </div>
            </div>
        </div>
        <button id="play-again-btn" class="mt-8 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg text-xl uppercase transition-colors">Play Again</button>
    </div>
    
    <!-- Screen 4: Settings Screen -->
    <div id="settings-screen" class="hidden w-full h-full p-8 flex flex-col justify-center items-center text-center">
        <h2 class="text-4xl font-black mb-6">Settings</h2>
        <div class="w-full max-w-md">
            <p class="text-xl mb-4">Round Duration (seconds)</p>
            <div id="duration-options" class="grid grid-cols-2 sm:grid-cols-4 gap-4"></div>
            <button id="back-to-menu-btn" class="mt-8 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-8 rounded-lg text-xl uppercase transition-colors">Back to Menu</button>
        </div>
    </div>

    <!-- Fullscreen Prompt Modal -->
    <div id="fullscreen-prompt" class="hidden absolute inset-0 bg-black bg-opacity-80 flex flex-col justify-center items-center text-center p-8 z-50">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl max-w-sm">
            <h3 class="text-2xl font-bold mb-4">Fullscreen Mode</h3>
            <p class="text-gray-300 mb-6">For the best experience, we recommend fullscreen and landscape mode. Would you like to enable it?</p>
            <div class="flex justify-center gap-4">
                <button id="prompt-yes-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg uppercase">Yes, Please!</button>
                <button id="prompt-no-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg uppercase">No, Thanks</button>
            </div>
        </div>
    </div>

    <!-- Screen 5: Countdown Screen -->
    <div id="countdown-screen" class="hidden absolute inset-0 bg-gray-900 flex-col justify-center items-center text-center z-50">
        <div id="countdown-display" class="text-9xl font-black text-yellow-400"></div>
    </div>

    <script src="categories.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const mainMenu = document.getElementById('main-menu');
            const gameScreen = document.getElementById('game-screen');
            const scoreScreen = document.getElementById('score-screen');
            const settingsScreen = document.getElementById('settings-screen');
            const countdownScreen = document.getElementById('countdown-screen');
            const countdownDisplay = document.getElementById('countdown-display');
            
            const categoryButtonsContainer = document.getElementById('category-buttons');
            const randomButtonContainer = document.getElementById('random-button-container');
            const currentScoreDisplay = document.getElementById('current-score');
            const timeLeftDisplay = document.getElementById('time-left');
            const wordDisplay = document.getElementById('word-display');
            const timerDisplay = document.getElementById('timer');

            const correctArea = document.getElementById('correct-area');
            const passArea = document.getElementById('pass-area');
            const correctFeedback = document.getElementById('correct-feedback');
            const passFeedback = document.getElementById('pass-feedback');

            const finalScoreDisplay = document.getElementById('final-score');
            const playAgainBtn = document.getElementById('play-again-btn');
            const endGameTitle = document.getElementById('end-game-title');
            const correctWordsList = document.getElementById('correct-words-list');
            const passedWordsList = document.getElementById('passed-words-list');
            
            const settingsBtn = document.getElementById('settings-btn');
            const stopGameBtn = document.getElementById('stop-game-btn');
            const backToMenuBtn = document.getElementById('back-to-menu-btn');
            const durationOptionsContainer = document.getElementById('duration-options');
            
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const fullscreenPrompt = document.getElementById('fullscreen-prompt');
            const promptYesBtn = document.getElementById('prompt-yes-btn');
            const promptNoBtn = document.getElementById('prompt-no-btn');

            // Game State
            let currentWordList = [];
            let correctWords = [];
            let passedWords = [];
            let score = 0;
            let timer;
            let roundDuration = 60; // Default duration
            let timeLeft = roundDuration;
            let isAnimating = false;
            let selectedCategory = null;

            // --- Game Logic ---

            function initializeApp() {
                const randomButton = document.createElement('button');
                randomButton.className = 'w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-4 rounded-lg text-2xl uppercase transition-colors tracking-wider';
                randomButton.textContent = '🎲 Random';
                randomButton.onclick = () => handleCategorySelection('Random');
                randomButtonContainer.appendChild(randomButton);

                Object.keys(categories).forEach(category => {
                    const button = document.createElement('button');
                    button.className = 'w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-4 rounded-lg text-xl uppercase transition-colors';
                    button.textContent = category;
                    button.onclick = () => handleCategorySelection(category);
                    categoryButtonsContainer.appendChild(button);
                });
                updateDurationSelection();
            }
            
            function handleCategorySelection(category) {
                selectedCategory = category;
                if (window.innerWidth < 768 && document.fullscreenEnabled) {
                    fullscreenPrompt.classList.remove('hidden');
                } else {
                    launchGame();
                }
            }
            
            function launchGame() {
                if (!selectedCategory) return;
                 // Prepare word list
                if (selectedCategory === 'Random') {
                    currentWordList = Object.values(categories).flat();
                } else {
                    currentWordList = [...categories[selectedCategory]];
                }
                shuffleArray(currentWordList);

                // Reset state
                score = 0;
                correctWords = [];
                passedWords = [];
                isAnimating = false;
                currentScoreDisplay.innerText = score;
                timeLeft = roundDuration;
                timeLeftDisplay.innerText = timeLeft;

                // UI transition
                mainMenu.classList.add('hidden');
                scoreScreen.classList.add('hidden');
                
                startCountdown();
            }

            function startCountdown() {
                countdownScreen.classList.remove('hidden');
                let count = 3;

                const updateCountdown = () => {
                    countdownDisplay.classList.remove('countdown-animate');
                    void countdownDisplay.offsetWidth; // Force reflow to restart animation
                    countdownDisplay.textContent = count;
                    countdownDisplay.classList.add('countdown-animate');
                };

                updateCountdown();

                const countdownInterval = setInterval(() => {
                    count--;
                    if (count > 0) {
                        updateCountdown();
                    } else {
                        clearInterval(countdownInterval);
                        countdownDisplay.textContent = 'Go!';
                        countdownDisplay.classList.add('countdown-animate');
                        setTimeout(() => {
                            countdownScreen.classList.add('hidden');
                            gameScreen.classList.remove('hidden');
                            nextWord();
                            startTimer();
                        }, 900);
                    }
                }, 1000);
            }
            
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            function startTimer() {
                timer = setInterval(() => {
                    timeLeft--;
                    timeLeftDisplay.innerText = timeLeft;
                    if (timeLeft <= 0) {
                        endGame('time');
                    }
                }, 1000);
            }

            function nextWord() {
                if (currentWordList.length === 0) {
                    endGame('words');
                    return;
                }
                wordDisplay.innerText = currentWordList.pop();
            }

            function handleCorrect() {
                if (isAnimating) return;
                isAnimating = true;
                correctFeedback.classList.remove('-translate-x-full');
                correctFeedback.classList.add('translate-x-0');

                setTimeout(() => {
                    score++;
                    correctWords.push(wordDisplay.innerText);
                    currentScoreDisplay.innerText = score;
                    nextWord();
                    correctFeedback.classList.remove('translate-x-0');
                    correctFeedback.classList.add('-translate-x-full');
                    isAnimating = false;
                }, 400);
            }

            function handlePass() {
                if (isAnimating) return;
                isAnimating = true;
                passFeedback.classList.remove('translate-x-full');
                passFeedback.classList.add('translate-x-0');

                setTimeout(() => {
                    const currentWord = wordDisplay.innerText;
                    if (currentWord && currentWord !== "No more words!") {
                        passedWords.push(currentWord);
                    }
                    nextWord();
                    passFeedback.classList.remove('translate-x-0');
                    passFeedback.classList.add('translate-x-full');
                    isAnimating = false;
                }, 400);
            }

            function endGame(reason) {
                clearInterval(timer);
                endGameTitle.innerText = reason === 'time' ? 'Time\'s Up!' : 'Round Complete!';
                finalScoreDisplay.innerText = score;
                correctWordsList.innerHTML = correctWords.length > 0 ? correctWords.map(word => `<li>- ${word}</li>`).join('') : '<li>None</li>';
                passedWordsList.innerHTML = passedWords.length > 0 ? passedWords.map(word => `<li>- ${word}</li>`).join('') : '<li>None</li>';
                gameScreen.classList.add('hidden');
                scoreScreen.classList.remove('hidden');
            }

            function returnToMenu() {
                clearInterval(timer);
                gameScreen.classList.add('hidden');
                scoreScreen.classList.add('hidden');
                mainMenu.classList.remove('hidden');
            }

            function updateDurationSelection() {
                durationOptionsContainer.innerHTML = '';
                const durations = [30, 60, 90, 120];
                durations.forEach(duration => {
                    const button = document.createElement('button');
                    button.textContent = duration;
                    const isActive = duration === roundDuration;
                    button.className = `font-bold py-3 px-4 rounded-lg text-lg uppercase transition-colors ${isActive ? 'bg-indigo-600 text-white' : 'bg-gray-700 hover:bg-gray-600 text-gray-300'}`;
                    button.onclick = () => {
                        roundDuration = duration;
                        updateDurationSelection();
                    };
                    durationOptionsContainer.appendChild(button);
                });
            }

            // --- Event Listeners ---
            correctArea.addEventListener('click', handleCorrect);
            passArea.addEventListener('click', handlePass);
            playAgainBtn.addEventListener('click', returnToMenu);
            stopGameBtn.addEventListener('click', () => {
                gameScreen.classList.add('opacity-0');
                setTimeout(() => {
                    returnToMenu();
                    gameScreen.classList.remove('opacity-0');
                }, 300);
            });
            
            settingsBtn.addEventListener('click', () => {
                mainMenu.classList.add('hidden');
                settingsScreen.classList.remove('hidden');
            });
            backToMenuBtn.addEventListener('click', () => {
                settingsScreen.classList.add('hidden');
                mainMenu.classList.remove('hidden');
            });
            fullscreenBtn.addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => console.error(`Fullscreen error: ${err.message}`));
                } else {
                    document.exitFullscreen();
                }
            });
            promptYesBtn.addEventListener('click', async () => {
                fullscreenPrompt.classList.add('hidden');
                try {
                    await document.documentElement.requestFullscreen();
                    await screen.orientation.lock('landscape');
                } catch (err) {
                    console.warn("Could not activate fullscreen or landscape.", err);
                } finally {
                    launchGame();
                }
            });
            promptNoBtn.addEventListener('click', () => {
                fullscreenPrompt.classList.add('hidden');
                launchGame();
            });

            // --- App Initialization ---
            initializeApp();
        });
    </script>
</body>
</html>

